---

- name: install dependency packages
  sudo: true
  apt: name={{ item }}
  with_items:
    - build-essential
    - default-jre
    - libpq-dev
    - libxml2-dev
    - libxslt1-dev
    - postgresql-client
    - python-psycopg2

- name: create a central environment folder
  sudo: true
  file:
    path=/opt/envs/
    state=directory
    group={{ application_user }}
    owner={{ application_user }}
    mode=755

- name: create a log directory
  sudo: true
  file:
    path=/var/log/sitterfiedapi/
    state=directory
    group={{ application_user }}
    owner={{ application_user }}
    mode=755

- name: create the static root directory
  sudo: true
  file:
    path=/www/
    state=directory
    group={{ application_user }}
    owner={{ application_user }}
    mode=755

- name: check if virtualenv exists
  stat: path={{ application_virtualenv_root }}
  register: virtualenv_path

- name: create a virtualenv
  sudo: true
  command: virtualenv {{ application_virtualenv_root }}
  when: virtualenv_path.stat.exists == false

- name: change ownership of virtualenv to the default user
  sudo: true
  file:
    path={{ application_virtualenv_root }}
    state=directory
    group={{ application_user }}
    owner={{ application_user }}
    recurse=yes

- name: create .bashrc helper
  sudo: true
  template:
    src=bashrc.sh.j2
    dest="{{ application_user_home }}/.bashrc"
    owner={{ application_user }}
    group={{ application_user }}
    mode=644

- name: Copy the robots.txt file to the static dir
  sudo: True
  copy:
    src=robots.txt
    dest=/www/robots.txt
    owner=root
    group=root
    mode=644
